{"version":3,"file":"map-viewer.js","sourceRoot":"","sources":["src/map-viewer.ts"],"names":[],"mappings":"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","sourcesContent":["import {LitElement, html} from 'lit';\r\nimport { customElement, property } from 'lit/decorators.js';\r\n\r\nimport './composants/DataLoader.js';\r\nimport './composants/toggle-data.js'\r\n\r\nimport {createCesiumViewer, zoomToDataSource} from \"./cesium/cesiumHelpers\";\r\nimport {addData, addTileset} from './cesium/dataLoader';\r\n\r\nimport {styles} from \"./styles/styles\";\r\nimport {Cesium3DTileset, DataSource, Viewer} from \"cesium\";\r\n\r\nimport apiService from \"./api/apiService\";\r\n\r\nimport {legend} from \"./cesium/dataLoader\";\r\n\r\n\r\n@customElement('map-viewer')\r\nexport class MapViewer extends LitElement{\r\n    static override styles = styles;\r\n\r\n    @property({type: Boolean})\r\n    loading = true;\r\n\r\n    @property({ type: String, attribute: 'cesium-base-url' })\r\n    cesiumBaseURL = '';\r\n\r\n    @property({ type: String, attribute: 'ion-token' })\r\n    ionToken = '';\r\n\r\n    @property({ type: Array, attribute: 'data-tileset', converter: {\r\n            fromAttribute: (value: any) => {\r\n                try {\r\n                    return new Map(JSON.parse(value));\r\n                } catch {\r\n                    return new Map();\r\n                }\r\n            },\r\n        }})\r\n    tilesetUrl:  Map<string, { url: string; icon: string | undefined, description: string | undefined, tileset?: Cesium3DTileset  }> = new Map();\r\n\r\n\r\n    @property({ type: Object, converter: {\r\n            fromAttribute: (value:any) => {\r\n                try {\r\n                    return new Map(JSON.parse(value));\r\n                } catch {\r\n                    return new Map();\r\n                }\r\n            },\r\n        }})\r\n    data: Map<string, { url: string; contour: boolean, icon: string | undefined, description: string | undefined, dataSource:DataSource | undefined, colorize: string | undefined   }> = new Map();\r\n\r\n    @property({type: String}) forestCover = \"\";\r\n    @property({type: String}) areaForestCover = \"\";\r\n    @property({type: Number}) currentTreeCount = 0;\r\n    @property({type: String}) urbanTree = \"\";\r\n\r\n\r\n\r\n    private _viewer: Viewer | undefined;\r\n\r\n    constructor() {\r\n        super();\r\n        this.attachShadow({ mode: 'open' });\r\n    }\r\n\r\n    override render() {\r\n        return html`\r\n      ${this.loading ? html`<div id=\"loadingScreen\">Loading...</div>` : null}\r\n      <div id=\"cesiumContainer\">\r\n      </div>\r\n      \r\n      <div id=\"legendContainer\">\r\n          <div id=\"dataContainer\">\r\n              <p class=\"dataTitle\">Total forest coverage</p>\r\n              <div class=\"dataSurface\">\r\n                  <div class=\"single-chart\">\r\n                      <svg viewBox=\"0 0 36 36\" class=\"circular-chart green\">\r\n                          <path class=\"circle-bg\"\r\n                                d=\"M18 2.0845\r\n          a 15.9155 15.9155 0 0 1 0 31.831\r\n          a 15.9155 15.9155 0 0 1 0 -31.831\"\r\n                          />\r\n                          <path class=\"circle ${this.loading ? '' : 'circle-animate'}\"\r\n                                stroke-dasharray=\"64.4, 100\"\r\n                                :style=\"circleStyle\"\r\n                                d=\"M18 2.0845\r\n          a 15.9155 15.9155 0 0 1 0 31.831\r\n          a 15.9155 15.9155 0 0 1 0 -31.831\"\r\n                          />\r\n                          <text x=\"18\" y=\"20.35\" class=\"percentage\">${this.forestCover}</text>\r\n                      </svg>\r\n                  </div>\r\n              </div>\r\n              <p class=\"dataTitle\">${this.areaForestCover} km2</p>\r\n          </div>\r\n          <div id=\"dataTreeContainer\">\r\n              <p class=\"dataTitle\">Number of urban tree</p>\r\n              <div class=\"dataSurface count\">\r\n                  <svg fill=\"#CBC118\" height=\"200px\" width=\"200px\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 489.8 489.8\" xml:space=\"preserve\">\r\n                      <g id=\"SVGRepo_bgCarrier\" stroke-width=\"0\"></g><g id=\"SVGRepo_tracerCarrier\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></g>\r\n                      <g id=\"SVGRepo_iconCarrier\"> <g> \r\n                          <g> <path d=\"M118.8,0.05C36.5,0.05,0,244.95,0,279.35c0,58.5,42.3,108,98,118v50.8H75c-11.5,0-20.8,9.4-20.8,20.8s9.4,20.8,20.8,20.8 h88.6c10.4,0,20.8-9.4,20.8-20.8s-9.4-20.8-20.8-20.8h-24v-50.8c55.9-10,98.9-59.4,98-118C237.6,244.95,201.1,0.05,118.8,0.05z M197,278.35c0,43.8-35.4,79.2-78.2,79.2c-42.7,0-78.2-35.4-78.2-79.2c0-70.9,50-237.6,78.2-237.6S198,207.45,197,278.35z\"></path> <path d=\"M489.8,325.25c0-29.2-28.1-215.7-94.8-215.7s-94.8,186.6-94.8,215.7c0,45.9,31.8,83.9,74,93.5v29.4h-12.5 c-11.5,0-20.8,9.4-20.8,20.8s9.4,20.8,20.8,20.8h66.7c11.5,0,20.8-9.4,20.8-20.8s-9.4-20.8-20.8-20.8h-12.5v-29.4 C458,409.15,489.8,371.05,489.8,325.25z M340.8,326.25c0-49,33.4-164.7,54.2-175.1c20.8,10.4,54.2,126.1,54.2,175.1 c0,30.2-24,55.2-54.2,55.2S340.8,356.45,340.8,326.25z\"></path> \r\n                          </g> </g> </g>\r\n                  </svg>\r\n                  <div class=\"counter\" data-target=${this.urbanTree}>${this.currentTreeCount}</div>\r\n              </div>\r\n          </div>\r\n          <div id=\"dataC02Container\">\r\n              <p class=\"dataTitle\">C0<sup>2</sup> absorbed per year </p>\r\n              <div class=\"dataSurface count\">\r\n                  <svg fill=\"#CBC118\" version=\"1.1\" id=\"Smoke\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 256 256\" enable-background=\"new 0 0 256 256\" xml:space=\"preserve\" stroke=\"#CBC118\"><g id=\"SVGRepo_bgCarrier\" stroke-width=\"0\"></g><g id=\"SVGRepo_tracerCarrier\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></g><g id=\"SVGRepo_iconCarrier\"> <path d=\"M220.37,102.96c1.66-4.58,2.5-9.39,2.5-14.34c0-23.29-18.95-42.24-42.24-42.24c-2.36,0-4.71,0.19-7.01,0.58 c-5.67-13.22-16.76-23.52-30.54-28.11C116.59,10.02,87.85,24.39,79,50.9c-0.06,0.16-0.11,0.33-0.17,0.49 c-7.15,2.98-12.97,8.1-16.84,14.46C46.56,63,30.46,68.32,19.83,80.13c-8.14,9.04-12.28,20.71-11.64,32.85 c0.63,12.14,5.96,23.31,14.99,31.45c2.91,2.62,6.09,4.83,9.5,6.6c-2.21,8.11-1.14,16.84,3.16,24.28 c4.26,7.37,11.13,12.65,19.35,14.85c2.75,0.74,5.54,1.1,8.31,1.1c5.52,0,10.97-1.45,15.88-4.28c3.85-2.23,7.22-5.3,9.88-8.98H137 c3.31,0,6-2.69,6-6s-2.69-6-6-6H86c-2.16,0-4.15,1.16-5.21,3.03c-1.8,3.15-4.43,5.83-7.41,7.56c-4.6,2.65-9.95,3.35-15.08,1.98 s-9.41-4.66-12.07-9.26c-3.34-5.79-3.545-12.817-0.56-18.81c0.872-1.75,0.927-3.81,0.247-5.25c-0.68-1.45-2.097-2.55-3.597-3.09 c-4.1-1.46-7.83-3.69-11.1-6.64c-6.66-6-10.58-14.22-11.05-23.17c-0.47-8.94,2.58-17.53,8.58-24.19c7.3-8.1,18.1-12.04,28.73-10.83 c-0.48,2.36-0.75,4.8-0.75,7.29c0,17.5,12.31,32.05,28.93,35.33C86.54,136.94,99.99,150,117,150h45c12.17,0,22.06,9.89,22.06,22.04 V178h12v-5.96c0-18.77-15.28-34.04-34.06-34.04h-45c-10.87,0-19.39-8.71-19.39-19.83v-3.55c0-3.23-2.55-5.88-5.77-6 c-12.96-0.48-23.11-11.02-23.11-24c0-10.55,6.76-19.76,16.82-22.91c1.99-0.63,3.51-2.24,4.02-4.26c0.22-0.88,0.5-1.82,0.82-2.77 c6.75-20.22,28.68-31.18,48.9-24.44c11.89,3.96,21.16,13.49,24.78,25.51c0.46,1.54,1.52,2.82,2.93,3.57 c1.42,0.75,3.08,0.91,4.61,0.42c2.89-0.9,5.93-1.36,9.02-1.36c16.68,0,30.24,13.56,30.24,30.24c0,2.78-0.37,5.5-1.1,8.12 c-4.54-1.79-9.49-2.77-14.7-2.77h-5.67c-5.54-14.74-21.4-23.38-37.09-19.53c-6.82,1.69-12.73,5.47-17.09,10.94 c-2.06,2.59-1.63,6.37,0.96,8.43c2.59,2.07,6.37,1.64,8.43-0.95c2.69-3.38,6.35-5.72,10.58-6.77 c10.48-2.57,21.132,3.852,23.67,14.35c0.921,3.81,3.328,5.53,6.2,5.53h10.01c16.22,0,28.93,13.63,28.93,31.03v41h12v-41 C236,123,229.94,110.77,220.37,102.96z M172.044,188.062L248,188v26h-12v24h-52v-24h-12L172.044,188.062z\"></path> </g></svg>\r\n                  <div class=\"counter\" data-target=${this.urbanTree}>${this.currentTreeCount * 22} Kg</div>\r\n              </div>\r\n          </div>\r\n      </div>\r\n      \r\n      <div id=\"buttonContainer\">\r\n          \r\n          <h2 class=\"groupTitle\">Layers</h2>\r\n          ${Array.from(this.tilesetUrl.entries()).map(\r\n                  ([key, value]) => html`\r\n                      <toggle-data\r\n                              .key=${key}\r\n                              .value=${value}\r\n                              .clickFunction=${() => this.toggleTilesetVisibility(key)}\r\n                      ></toggle-data>\r\n                  `\r\n          )}\r\n          \r\n          <h2 class=\"groupTitle\">Data</h2>\r\n          ${Array.from(this.data.entries()).map(\r\n                  ([key, value]) => html`\r\n                      <toggle-data\r\n                              .key=${key}\r\n                              .value=${value}\r\n                              .clickFunction=${() => this.toggleDataVisibility(key)}\r\n                      ></toggle-data>\r\n          `\r\n          )}\r\n          \r\n      </div>\r\n    `;\r\n    }\r\n\r\n\r\n    toggleDataVisibility(key: string) {\r\n        const data  = this.data.get(key);\r\n        console.log(\"key is \" + key)\r\n        if (data) {\r\n            if (data.dataSource) {\r\n                data.dataSource.show = !data.dataSource.show;\r\n                if (key === 'zone' && this.shadowRoot) {\r\n                    const legend = this.shadowRoot.querySelector('#legend');\r\n                    if (legend) {\r\n                        // Se la dataSource è visibile, mostra la legenda, altrimenti nascondila\r\n                        legend.style.display = data.dataSource.show ? 'flex' : 'none';\r\n                    }\r\n                }\r\n                if (key === 'forest' && this.shadowRoot) {\r\n                    const forestApi = this.shadowRoot.querySelector('#dataContainer');\r\n                    if (forestApi) {\r\n                        // Se la dataSource è visibile, mostra la legenda, altrimenti nascondila\r\n                        forestApi.style.display = data.dataSource.show ? 'flex' : 'none';\r\n                    }\r\n                }\r\n                if (key === 'tree' && this.shadowRoot) {\r\n                    const treeApi = this.shadowRoot.querySelector('#dataTreeContainer');\r\n                    const C02Api = this.shadowRoot.querySelector('#dataC02Container');\r\n                    if (treeApi) {\r\n                        // Se la dataSource è visibile, mostra la legenda, altrimenti nascondila\r\n                        treeApi.style.display = data.dataSource.show ? 'flex' : 'none';\r\n                        C02Api.style.display = data.dataSource.show ? 'flex' : 'none';\r\n                        // Start animation\r\n                        this.animateCounters();\r\n                        if(!data.dataSource.show){\r\n                            this.currentTreeCount = 0\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    toggleTilesetVisibility(key: string) {\r\n        const tilesetInfo = this.tilesetUrl.get(key);\r\n        console.log(tilesetInfo)\r\n        if (tilesetInfo && tilesetInfo.tileset) {\r\n            tilesetInfo.tileset.show = !tilesetInfo.tileset.show;\r\n        }\r\n    }\r\n\r\n    createLegend() {\r\n        // Create a legend element\r\n        const legendElement = document.createElement('div');\r\n        legendElement.id = 'legend';\r\n        legendElement.style.display = \"none\"\r\n\r\n        if(this.shadowRoot){\r\n            // @ts-ignore\r\n            this.shadowRoot.querySelector(\"#legendContainer\").appendChild(legendElement);  // Append to shadowRoot instead of document.body\r\n        }\r\n        // Populate the legend with color-information\r\n        legend.forEach((color, property) => {\r\n            const item = document.createElement('div');\r\n            item.className = \"legend-container\"\r\n\r\n            const key = document.createElement('div');\r\n            key.className = 'legend-key';\r\n            key.style.backgroundColor = color.toCssColorString();\r\n            key.style.display = 'inline-block';\r\n            key.style.width = '20px';\r\n            key.style.height = '20px';\r\n\r\n            const value = document.createElement('p');\r\n            value.className = \"legend-value\"\r\n            value.innerHTML = property;\r\n\r\n            item.appendChild(key);\r\n            item.appendChild(value);\r\n            legendElement.appendChild(item);\r\n        });\r\n    }\r\n\r\n\r\n    override async updated(changedProperties: Map<string, unknown>) {\r\n        if (changedProperties.has('data') && this.data.size > 0) {\r\n            const dataPromises = Array.from(this.data.entries()).map(async ([_, value]) => {\r\n                const dataSource = await addData(this._viewer, value.url, value.contour, value.colorize);\r\n                await zoomToDataSource(this._viewer, dataSource);\r\n                value.dataSource = dataSource;\r\n                // Create the legend\r\n            });\r\n\r\n            await Promise.all(dataPromises);\r\n            this.createLegend();\r\n            this.loading = false;\r\n        }\r\n\r\n        if (changedProperties.has('tilesetUrl') && this.tilesetUrl.size > 0) {\r\n            const tilesetPromises = Array.from(this.tilesetUrl.entries()).map(async ([_, value]) => {\r\n                if (this._viewer) {\r\n                    value.tileset = addTileset(this._viewer, value.url);\r\n                }\r\n            });\r\n            await Promise.all(tilesetPromises);\r\n        }\r\n\r\n    }\r\n\r\n    override async firstUpdated(_changedProperties: Map<string, unknown>) {\r\n        super.firstUpdated(_changedProperties);\r\n        this._viewer = createCesiumViewer(\r\n            this.shadowRoot!.getElementById(\"cesiumContainer\")!,\r\n            this.cesiumBaseURL,\r\n        );\r\n\r\n        this.forestCover = await apiService.getData(\"percentage\", 'forest');\r\n        this.areaForestCover = await apiService.getData(\"area\", 'forest');\r\n        this.urbanTree = await apiService.getData(\"trees\");\r\n    }\r\n\r\n    animateCounters() {\r\n        const speed = 200; // The lower the slower\r\n\r\n        const updateCount = () => {\r\n            const target = this.urbanTree;\r\n            const inc = target / speed;\r\n\r\n            // @ts-ignore\r\n            if (this.currentTreeCount < target) {\r\n                this.currentTreeCount += Math.round(inc);\r\n                setTimeout(updateCount, 1);\r\n            } else {\r\n                this.currentTreeCount = target;\r\n            }\r\n        };\r\n\r\n        updateCount();\r\n    }\r\n\r\n\r\n}\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'map-viewer': MapViewer;\r\n    }\r\n}\r\n"]}